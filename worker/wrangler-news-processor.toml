name = "crypto-news-processor"
main = "news-processor-consumer.js"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

# AI binding for sentiment analysis and summarization
[ai]
binding = "AI"

# KV namespace for storing analyzed news
[[kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with actual KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE"
# See DEPLOYMENT_GUIDE.md Step 2 for instructions
id = "REPLACE_WITH_YOUR_KV_NAMESPACE_ID_FROM_STEP_2"

# Queue consumer configuration
[[queues.consumers]]
queue = "crypto-article-queue"
max_batch_size = 1  # Process one article at a time to stay within subrequest limits
max_batch_timeout = 30  # Wait up to 30 seconds before processing incomplete batch
max_retries = 3  # Retry failed messages up to 3 times
dead_letter_queue = "crypto-article-dlq"  # Send failed messages to dead letter queue

[env.production]
# Production environment configuration
[[env.production.kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with production KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE" --env production
id = "REPLACE_WITH_YOUR_PRODUCTION_KV_NAMESPACE_ID"

[[env.production.queues.consumers]]
queue = "crypto-article-queue"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "crypto-article-dlq"
