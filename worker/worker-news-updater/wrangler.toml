name = "crypto-news-updater"
main = "index.js"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

# Cron trigger - runs every hour at the top of the hour
# Format: "minute hour day month day-of-week"
# "0 * * * *" = every hour at minute 0
[triggers]
crons = ["0 * * * *"]

# AI binding for sentiment analysis
[ai]
binding = "AI"

# KV namespace for storing analyzed news
[[kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with actual KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE"
# See DEPLOYMENT_GUIDE.md Step 2 for instructions
id = "4933e1596e304b71b4aac4cae364b75f"

# Environment bindings
# The NEWSDATA_API_KEY should be set using: wrangler secret put NEWSDATA_API_KEY
# The APITUBE_API_KEY should be set using: wrangler secret put APITUBE_API_KEY
# The NEWS_PROVIDER should be set using: wrangler secret put NEWS_PROVIDER
#   - Set to 'newsdata' for NewsData.io (default if not set)
#   - Set to 'apitube' for APITube
# This keeps the API keys secure and out of version control

# Configuration variables (optional - defaults are set in shared/constants.js)
# Uncomment and modify these to override defaults:
[vars]
NEWS_PROVIDER = "apitube"       # News provider: 'newsdata' or 'apitube'
# MAX_STORED_ARTICLES = 500      # Maximum articles to keep in KV (default: 500)
# MAX_PAGES = 15                 # Maximum pages to fetch from API (default: 15)
# ID_INDEX_TTL = 2592000         # ID index TTL in seconds (default: 30 days)

# Observability configuration for logs and traces
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1

[env.production]
# Production environment configuration
# Secrets are automatically available in env.NEWSDATA_API_KEY, env.APITUBE_API_KEY, and env.NEWS_PROVIDER
[[env.production.kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with production KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE" --env production
id = "4933e1596e304b71b4aac4cae364b75f"

# Production-specific variables (optional)
# [env.production.vars]
# MAX_STORED_ARTICLES = 1000     # Store more articles in production
