name = "crypto-cache"
main = "index.js"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

# AI binding for LLM summarization
[ai]
binding = "AI"

# D1 database for article storage and queries
[[d1_databases]]
binding = "DB"
database_name = "crypto-news-db"
database_id = "REPLACE_WITH_YOUR_D1_DATABASE_ID"
# Create database with: wrangler d1 create crypto-news-db
# Initialize schema with: wrangler d1 execute crypto-news-db --file=../schema.sql
# See D1_SETUP_GUIDE.md for detailed instructions

# KV namespace for reading cached news (written by news-updater-cron worker)
[[kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with actual KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE"
# See DEPLOYMENT_GUIDE.md Step 2 for instructions
id = "4933e1596e304b71b4aac4cae364b75f"

# Environment bindings
# The COINGECKO_KEY should be set using: wrangler secret put COINGECKO_KEY
# The NEWSDATA_API_KEY should be set using: wrangler secret put NEWSDATA_API_KEY (no longer needed after migration)
# This keeps the API keys secure and out of version control

# Observability configuration for logs and traces
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
persist = true
head_sampling_rate = 1

[env.production]
# Production environment configuration
# Secrets are automatically available in env.COINGECKO_KEY and env.NEWSDATA_API_KEY
[[env.production.d1_databases]]
binding = "DB"
database_name = "crypto-news-db"
database_id = "REPLACE_WITH_YOUR_PRODUCTION_D1_DATABASE_ID"
# Create production database with: wrangler d1 create crypto-news-db --env production

[[env.production.kv_namespaces]]
binding = "CRYPTO_NEWS_CACHE"
# Replace with production KV namespace ID from: wrangler kv:namespace create "CRYPTO_NEWS_CACHE" --env production
id = "4933e1596e304b71b4aac4cae364b75f"
